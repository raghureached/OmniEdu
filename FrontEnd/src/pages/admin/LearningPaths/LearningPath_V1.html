<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create / Edit Learning Path</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            color: #2c3e50;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .page-header {
            background: white;
            padding: 20px 30px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .page-header h1 {
            color: #2c3e50;
            font-size: 28px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
        }

        .form-section {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .section-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #34495e;
        }

        .required::after {
            content: " *";
            color: #e74c3c;
        }

        input[type="text"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #dce4ec;
            border-radius: 4px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #3498db;
        }

        textarea {
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }

        .reward-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .checkbox-group {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 4px;
            margin-bottom: 15px;
        }

        .checkbox-group input[type="checkbox"] {
            margin-top: 3px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .checkbox-group label {
            margin: 0;
            cursor: pointer;
            flex: 1;
        }

        .help-text {
            display: none;
            margin-top: 8px;
            padding: 10px;
            background: #e3f2fd;
            border-left: 3px solid #2196f3;
            font-size: 13px;
            color: #1976d2;
        }

        .help-text.visible {
            display: block;
        }

        .image-upload {
            border: 2px dashed #dce4ec;
            border-radius: 4px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: border-color 0.3s;
        }

        .image-upload:hover {
            border-color: #3498db;
        }

        .image-upload input {
            display: none;
        }

        .live-summary {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: sticky;
            top: 20px;
            height: fit-content;
        }

        .summary-item {
            padding: 12px;
            background: #f8f9fa;
            border-radius: 4px;
            margin-bottom: 10px;
        }

        .summary-item strong {
            display: block;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .content-builder {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-top: 20px;
        }

        .elements-list {
            min-height: 100px;
            margin-bottom: 20px;
        }

        .element-card {
            background: #f8f9fa;
            border: 1px solid #dce4ec;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: move;
            transition: all 0.3s;
        }

        .element-card:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-color: #3498db;
        }

        .element-card.dragging {
            opacity: 0.5;
        }

        .element-card.error {
            border-color: #e74c3c;
            background: #fee;
        }

        .drag-handle {
            font-size: 20px;
            color: #95a5a6;
            cursor: grab;
        }

        .drag-handle:active {
            cursor: grabbing;
        }

        .element-type {
            padding: 4px 12px;
            background: #3498db;
            color: white;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            min-width: 90px;
            text-align: center;
        }

        .element-type.assessment {
            background: #9b59b6;
        }

        .element-info {
            flex: 1;
        }

        .element-title {
            font-weight: 600;
            color: #2c3e50;
        }

        .element-duration {
            font-size: 13px;
            color: #7f8c8d;
        }

        .error-icon {
            color: #e74c3c;
            font-size: 20px;
        }

        .remove-btn {
            padding: 6px 12px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: background 0.3s;
        }

        .remove-btn:hover {
            background: #c0392b;
        }

        .add-element-btn {
            width: 100%;
            padding: 15px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }

        .add-element-btn:hover {
            background: #2980b9;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 8px;
            max-width: 600px;
            width: 90%;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #2c3e50;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-success:hover {
            background: #229954;
        }
        
        /* New Preview Button style */
        .btn-info {
            background: #3498db;
            color: white;
        }
        
        .btn-info:hover {
            background: #2980b9;
        }

        .btn-warning {
            background: #f39c12;
            color: white;
        }

        .btn-warning:hover {
            background: #e67e22;
        }

        .assessment-config {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
        }

        .config-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .config-row input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .config-row label {
            margin: 0;
            cursor: pointer;
            flex: 1;
        }

        .locked-info {
            background: #fff3cd;
            border: 1px solid #ffc107;
            padding: 12px;
            border-radius: 4px;
            margin-top: 15px;
            font-size: 13px;
            color: #856404;
        }

        .locked-info strong {
            display: block;
            margin-bottom: 5px;
        }

        .info-icon {
            color: #ffc107;
            margin-right: 5px;
        }

        .page-actions {
            background: white;
            padding: 20px 30px;
            margin-top: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            gap: 15px;
            justify-content: flex-end;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #95a5a6;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .question-input-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .question-input-group input[type="number"] {
            width: 100px; /* Reduced width for better spacing */
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .live-summary {
                position: static;
            }

            .reward-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="page-header">
            <h1>Create / Edit Learning Path</h1>
        </div>

        <div class="main-content">
            <div>
                <div class="form-section">
                    <h2 class="section-title">Learning Path Details</h2>
                    
                    <div class="form-group">
                        <label class="required">Name / Title</label>
                        <input type="text" id="pathName" placeholder="Enter learning path name">
                    </div>

                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="pathDescription" placeholder="Enter detailed description"></textarea>
                    </div>

                    <div class="form-group">
                        <label>Prerequisite</label>
                        <select id="prerequisite">
                            <option value="">None</option>
                            <option value="path1">Introduction to Web Development</option>
                            <option value="path2">JavaScript Fundamentals</option>
                            <option value="path3">Data Structures Basics</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Tags</label>
                        <input type="text" id="tags" placeholder="Enter tags separated by commas">
                    </div>

                    <div class="form-group">
                        <label>Intended for - Team</label>
                        <select id="team">
                            <option value="">Select Team</option>
                            <option value="engineering">Engineering</option>
                            <option value="sales">Sales</option>
                            <option value="marketing">Marketing</option>
                            <option value="hr">Human Resources</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Intended for - Sub-team</label>
                        <select id="subteam">
                            <option value="">Select Sub-team</option>
                            <option value="frontend">Frontend</option>
                            <option value="backend">Backend</option>
                            <option value="devops">DevOps</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Category of Training</label>
                        <select id="category">
                            <option value="">Select Category</option>
                            <option value="technical">Technical Skills</option>
                            <option value="soft">Soft Skills</option>
                            <option value="compliance">Compliance</option>
                            <option value="leadership">Leadership</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Rewards</label>
                        <div class="reward-grid">
                            <div>
                                <label>Credits</label>
                                <input type="number" id="credits" min="0" value="0">
                            </div>
                            <div>
                                <label>Badges</label>
                                <input type="number" id="badges" min="0" value="0">
                            </div>
                            <div>
                                <label>Stars</label>
                                <input type="number" id="stars" min="0" value="0">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Cover Image</label>
                        <div class="image-upload" onclick="document.getElementById('imageInput').click()">
                            <input type="file" id="imageInput" accept="image/*">
                            <div>📁 Click to upload image</div>
                            <div style="font-size: 12px; color: #95a5a6; margin-top: 5px;">Recommended size: 1200x600px</div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Configuration</label>
                        <div class="checkbox-group">
                            <input type="checkbox" id="enforceOrder" checked>
                            <label for="enforceOrder">
                                <strong>Enforce path order</strong>
                                <div class="help-text visible" id="orderHelp">
                                    Learners must complete elements sequentially in the order defined below.
                                </div>
                            </label>
                        </div>

                        <div class="checkbox-group">
                            <input type="checkbox" id="bypassRewards">
                            <label for="bypassRewards">
                                <strong>Bypass individual rewards</strong>
                                <div class="help-text" id="bypassHelp">
                                    Users will only receive the overall path rewards upon completion.
                                </div>
                            </label>
                        </div>

                        <div class="checkbox-group">
                            <input type="checkbox" id="enableFeedback">
                            <label for="enableFeedback">
                                <strong>Enable feedback/reactions</strong>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="content-builder">
                    <h2 class="section-title">Path Content Builder</h2>
                    
                    <div class="elements-list" id="elementsList">
                        <div class="empty-state">
                            <div class="empty-state-icon">📚</div>
                            <p>No elements added yet. Click "Add Element" to start building your learning path.</p>
                        </div>
                    </div>

                    <button class="add-element-btn" onclick="openAddElementModal()">+ Add Element</button>
                </div>
            </div>

            <div class="live-summary">
                <h3 class="section-title">Live Summary</h3>
                <div class="summary-item">
                    <strong>Content</strong>
                    <div id="contentSummary">0 Modules, 0 Assessments</div>
                </div>
                <div class="summary-item">
                    <strong>Total Duration</strong>
                    <div id="durationSummary">0 minutes</div>
                </div>
            </div>
        </div>

        <div class="page-actions">
            <button class="btn btn-secondary" onclick="saveDraft()">Save Draft</button>
            <button class="btn btn-info" onclick="previewPath()">Preview</button>
            <button class="btn btn-warning" onclick="duplicatePath()">Duplicate</button>
            <button class="btn btn-success" onclick="publishPath()">Publish</button>
        </div>
    </div>

    <div class="modal" id="addElementModal">
        <div class="modal-content">
            <h3 class="modal-header">Add Element to Path</h3>
            
            <div class="form-group">
                <label class="required">Element Type</label>
                <select id="elementType" onchange="updateElementList()">
                    <option value="">Select Type</option>
                    <option value="module">Module</option>
                    <option value="assessment">Assessment</option>
                </select>
            </div>

            <div class="form-group">
                <label class="required">Select Element</label>
                <select id="elementSelect" onchange="handleElementSelection()">
                    <option value="">First select an element type</option>
                </select>
            </div>

            <div id="assessmentConfigSection" style="display: none;">
                <div class="assessment-config">
                    <h4 style="margin-bottom: 15px; font-size: 16px; color: #2c3e50;">Assessment Configuration</h4>
                    
                    <div class="form-group">
                        <label for="numQuestions">Number of Questions to Include</label>
                        <div class="question-input-group">
                            <input type="number" id="numQuestions" min="1" oninput="updateEstimatedDuration()">
                            <span id="maxQuestionInfo" style="font-size: 14px; color: #7f8c8d;"></span>
                        </div>
                        <div id="estimatedDuration" style="font-size: 13px; color: #27ae60; margin-top: 5px; font-weight: 600;"></div>
                    </div>
                    
                    <hr style="border: 0; border-top: 1px solid #dce4ec; margin: 15px 0;">

                    <div class="config-row">
                        <input type="checkbox" id="randomizeQuestions">
                        <label for="randomizeQuestions">Randomize question order</label>
                    </div>

                    <div class="config-row">
                        <input type="checkbox" id="randomizeOptions">
                        <label for="randomizeOptions">Randomize answer options</label>
                    </div>
                </div>

                <div class="locked-info">
                    <strong><span class="info-icon">🔒</span>Locked Properties</strong>
                    The following properties are configured at the assessment level and cannot be changed here:
                    <ul style="margin: 8px 0 0 20px; line-height: 1.8;">
                        <li>Number of attempts allowed</li>
                        <li>Pass percentage required</li>
                        <li>When to display correct answers</li>
                    </ul>
                </div>
            </div>

            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeAddElementModal()">Cancel</button>
                <button class="btn btn-primary" onclick="addElementToPath()">Add to Path</button>
            </div>
        </div>
    </div>

    <div class="modal" id="removeModal">
        <div class="modal-content">
            <h3 class="modal-header">Confirm Removal</h3>
            <p>Are you sure you want to remove this element?</p>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeRemoveModal()">Cancel</button>
                <button class="btn btn-primary" onclick="confirmRemove()">Remove</button>
            </div>
        </div>
    </div>

    <script>
        // Sample data
        const modules = [
            { id: 'm1', title: 'Introduction to HTML', duration: 45 },
            { id: 'm2', title: 'CSS Fundamentals', duration: 60 },
            { id: 'm3', title: 'JavaScript Basics', duration: 90 },
            { id: 'm4', title: 'Responsive Design', duration: 75 },
            { id: 'm5', title: 'Web Accessibility', duration: 50 }
        ];

        // Assessments data with calculated timePerQuestion
        const assessments = [
            { 
                id: 'a1', 
                title: 'HTML Knowledge Check', 
                duration: 20, // Total time for the full pool
                timePerQuestion: 4, // 20 / 5 = 4 min/question
                questions: [
                    { id: 'q1', text: 'Q1' }, { id: 'q2', text: 'Q2' }, { id: 'q3', text: 'Q3' }, 
                    { id: 'q4', text: 'Q4' }, { id: 'q5', text: 'Q5' }
                ]
            },
            { 
                id: 'a2', 
                title: 'CSS Skills Assessment', 
                duration: 25, // Total time for the full pool
                timePerQuestion: 5, // 25 / 5 = 5 min/question
                questions: [
                    { id: 'q6', text: 'Q6' }, { id: 'q7', text: 'Q7' }, { id: 'q8', text: 'Q8' }, 
                    { id: 'q9', text: 'Q9' }, { id: 'q10', text: 'Q10' }
                ]
            },
            { 
                id: 'a3', 
                title: 'JavaScript Quiz', 
                duration: 30, // Total time for the full pool
                timePerQuestion: 6, // 30 / 5 = 6 min/question
                questions: [
                    { id: 'q11', text: 'Q11' }, { id: 'q12', text: 'Q12' }, { id: 'q13', text: 'Q13' }, 
                    { id: 'q14', text: 'Q14' }, { id: 'q15', text: 'Q15' }
                ]
            },
            { 
                id: 'a4', 
                title: 'Final Project Evaluation', 
                duration: 45, // Total time for the full pool
                timePerQuestion: 15, // 45 / 3 = 15 min/question
                questions: [
                    { id: 'q16', text: 'Q16' }, { id: 'q17', text: 'Q17' }, { id: 'q18', text: 'Q18' }
                ]
            }
        ];

        let pathElements = [];
        let elementToRemove = null;
        let draggedElement = null;
        let currentAssessment = null;

        // Checkbox help text toggle
        document.getElementById('enforceOrder').addEventListener('change', function() {
            document.getElementById('orderHelp').classList.toggle('visible', this.checked);
        });

        document.getElementById('bypassRewards').addEventListener('change', function() {
            document.getElementById('bypassHelp').classList.toggle('visible', this.checked);
        });

        // Update element list based on type
        function updateElementList() {
            const type = document.getElementById('elementType').value;
            const select = document.getElementById('elementSelect');
            select.innerHTML = '<option value="">Select an element</option>';
            
            // Hide assessment config section by default
            document.getElementById('assessmentConfigSection').style.display = 'none';
            // Clear current assessment info
            currentAssessment = null;

            if (type === 'module') {
                modules.forEach(m => {
                    // Check if module is already in pathElements (simple check by ID)
                    if (!pathElements.find(e => e.id === m.id)) {
                        select.innerHTML += `<option value="${m.id}">${m.title} (${m.duration} min)</option>`;
                    }
                });
            } else if (type === 'assessment') {
                assessments.forEach(a => {
                    // Check if assessment is already in pathElements (simple check by ID)
                    if (!pathElements.find(e => e.id === a.id)) {
                        // Display the number of questions available
                        select.innerHTML += `<option value="${a.id}">${a.title} (${a.questions.length} Qs available)</option>`;
                    }
                });
            }
        }

        // Handle element selection (show question count selector for assessments)
        function handleElementSelection() {
            const type = document.getElementById('elementType').value;
            const elementId = document.getElementById('elementSelect').value;
            
            if (type === 'assessment' && elementId) {
                currentAssessment = assessments.find(a => a.id === elementId);
                showAssessmentConfig(currentAssessment);
            } else {
                document.getElementById('assessmentConfigSection').style.display = 'none';
                currentAssessment = null;
            }
        }

        // Show assessment configuration
        function showAssessmentConfig(assessment) {
            const configSection = document.getElementById('assessmentConfigSection');
            const numQuestionsInput = document.getElementById('numQuestions');
            const maxQuestionInfo = document.getElementById('maxQuestionInfo');
            
            configSection.style.display = 'block';
            
            const maxQs = assessment.questions.length;
            const timePerQ = assessment.timePerQuestion;
            
            // Set input constraints
            numQuestionsInput.max = maxQs;
            numQuestionsInput.min = 1;
            numQuestionsInput.value = maxQs; // Default to maximum
            
            // Display max question info
            maxQuestionInfo.textContent = `Max: ${maxQs} questions (${timePerQ} min/Q)`;

            // Initial duration update
            updateEstimatedDuration();
        }

        // Update selected question count and estimated duration
        function updateEstimatedDuration() {
            if (!currentAssessment) return;

            const numQuestionsInput = document.getElementById('numQuestions');
            const durationDisplay = document.getElementById('estimatedDuration');
            const maxQs = currentAssessment.questions.length;
            
            let numQuestions = parseInt(numQuestionsInput.value) || 0;

            // Enforce max/min constraints
            if (numQuestions < 1) {
                numQuestions = 1;
                numQuestionsInput.value = 1;
            }
            if (numQuestions > maxQs) {
                numQuestions = maxQs;
                numQuestionsInput.value = maxQs;
            }
            
            const calculatedDuration = numQuestions * currentAssessment.timePerQuestion;
            durationDisplay.textContent = `Est. duration: ${calculatedDuration} minutes for ${numQuestions} questions.`;
        }

        // Modal functions
        function openAddElementModal() {
            document.getElementById('addElementModal').classList.add('active');
            document.getElementById('elementType').value = '';
            document.getElementById('elementSelect').innerHTML = '<option value="">First select an element type</option>';
            document.getElementById('assessmentConfigSection').style.display = 'none';
            currentAssessment = null;
        }

        function closeAddElementModal() {
            document.getElementById('addElementModal').classList.remove('active');
            currentAssessment = null;
        }

        function openRemoveModal(id) {
            elementToRemove = id;
            document.getElementById('removeModal').classList.add('active');
        }

        function closeRemoveModal() {
            elementToRemove = null;
            document.getElementById('removeModal').classList.remove('active');
        }

        // Add element to path
        function addElementToPath() {
            const type = document.getElementById('elementType').value;
            const elementId = document.getElementById('elementSelect').value;

            if (!type || !elementId) {
                alert('Please select both element type and element');
                return;
            }

            let element;
            if (type === 'module') {
                element = modules.find(m => m.id === elementId);
                element.type = 'module';
            } else {
                element = assessments.find(a => a.id === elementId);
                element.type = 'assessment';
                
                const numQuestionsInput = document.getElementById('numQuestions');
                const numQuestions = parseInt(numQuestionsInput.value);
                const maxQs = element.questions.length;

                // Validation
                if (isNaN(numQuestions) || numQuestions < 1 || numQuestions > maxQs) {
                    alert(`Please enter a valid number of questions between 1 and ${maxQs}.`);
                    numQuestionsInput.focus();
                    return;
                }
                
                // Calculate new duration based on selected question count
                const calculatedDuration = numQuestions * element.timePerQuestion;
                
                // Add assessment configuration and calculated properties
                element.questionCount = numQuestions;
                element.randomizeQuestions = document.getElementById('randomizeQuestions').checked;
                element.randomizeOptions = document.getElementById('randomizeOptions').checked;
                element.duration = calculatedDuration; // Overwrite duration with the calculated value
            }

            // Create a copy before pushing to pathElements
            pathElements.push({ ...element });
            renderElements();
            updateSummary();
            closeAddElementModal();
        }

        // Remove element
        function confirmRemove() {
            pathElements = pathElements.filter(e => e.id !== elementToRemove);
            renderElements();
            updateSummary();
            closeRemoveModal();
        }

        // Render elements
        function renderElements() {
            const container = document.getElementById('elementsList');
            
            if (pathElements.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">📚</div>
                        <p>No elements added yet. Click "Add Element" to start building your learning path.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = pathElements.map(el => {
                let detailText = `${el.duration} minutes`;
                if (el.type === 'assessment' && el.questionCount) {
                    detailText += ` • ${el.questionCount} questions`;
                    if (el.randomizeQuestions || el.randomizeOptions) {
                        detailText += ' • ';
                        const randomOptions = [];
                        if (el.randomizeQuestions) randomOptions.push('Random Q');
                        if (el.randomizeOptions) randomOptions.push('Random Opt');
                        detailText += randomOptions.join(', ');
                    }
                }
                
                return `
                    <div class="element-card" draggable="true" data-id="${el.id}">
                        <div class="drag-handle">⋮⋮</div>
                        <div class="element-type ${el.type}">${el.type}</div>
                        <div class="element-info">
                            <div class="element-title">${el.title}</div>
                            <div class="element-duration">${detailText}</div>
                        </div>
                        <button class="remove-btn" onclick="openRemoveModal('${el.id}')">Remove</button>
                    </div>
                `;
            }).join('');

            attachDragListeners();
        }

        // Drag and drop functionality
        function attachDragListeners() {
            const cards = document.querySelectorAll('.element-card');
            
            cards.forEach(card => {
                card.addEventListener('dragstart', handleDragStart);
                card.addEventListener('dragend', handleDragEnd);
                card.addEventListener('dragover', handleDragOver);
                card.addEventListener('drop', handleDrop);
            });
        }

        function handleDragStart(e) {
            draggedElement = this;
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragEnd(e) {
            this.classList.remove('dragging');
        }

        function handleDragOver(e) {
            if (e.preventDefault) {
                e.preventDefault();
            }
            e.dataTransfer.dropEffect = 'move';
            return false;
        }

        function handleDrop(e) {
            if (e.stopPropagation) {
                e.stopPropagation();
            }

            if (draggedElement !== this) {
                const draggedId = draggedElement.getAttribute('data-id');
                const droppedOnId = this.getAttribute('data-id');
                
                const draggedIndex = pathElements.findIndex(e => e.id === draggedId);
                const droppedIndex = pathElements.findIndex(e => e.id === droppedOnId);
                
                const [removed] = pathElements.splice(draggedIndex, 1);
                pathElements.splice(droppedIndex, 0, removed);
                
                renderElements();
            }

            return false;
        }

        // Update summary
        function updateSummary() {
            const moduleCount = pathElements.filter(e => e.type === 'module').length;
            const assessmentCount = pathElements.filter(e => e.type === 'assessment').length;
            
            const totalDuration = pathElements.reduce((sum, e) => sum + (e.duration || 0), 0);

            document.getElementById('contentSummary').textContent = 
                `${moduleCount} Module${moduleCount !== 1 ? 's' : ''}, ${assessmentCount} Assessment${assessmentCount !== 1 ? 's' : ''}`;
            document.getElementById('durationSummary').textContent = `${totalDuration} minutes`;
        }

        // Page actions
        function saveDraft() {
            const name = document.getElementById('pathName').value;
            if (!name) {
                alert('Please enter a name for the learning path');
                return;
            }
            alert('Learning path details and structure saved as draft! (Elements are automatically saved to your path when added.)');
        }
        
        // NEW: Preview function
        function previewPath() {
            const name = document.getElementById('pathName').value;
            if (!name) {
                alert('Please enter a name/title for the learning path before previewing.');
                return;
            }
            if (pathElements.length === 0) {
                alert('Add elements to the path before previewing the content structure.');
                return;
            }
            
            let previewMessage = `--- PREVIEW: ${name} ---\n`;
            previewMessage += `Total Duration: ${document.getElementById('durationSummary').textContent}\n`;
            previewMessage += `Elements (${pathElements.length}):\n`;
            
            pathElements.forEach((el, index) => {
                let details = '';
                if (el.type === 'assessment') {
                    details = ` (${el.questionCount} Qs, Randomize Q: ${el.randomizeQuestions ? 'Yes' : 'No'})`;
                }
                previewMessage += `\n${index + 1}. [${el.type.toUpperCase()}] ${el.title} - ${el.duration} min${details}`;
            });
            
            alert(previewMessage);
        }

        function publishPath() {
            const name = document.getElementById('pathName').value;
            if (!name) {
                alert('Please enter a name for the learning path');
                return;
            }
            if (pathElements.length === 0) {
                alert('Please add at least one element to the learning path');
                return;
            }
            alert('Learning path published successfully!');
        }

        function duplicatePath() {
            if (confirm('Create a duplicate of this learning path?')) {
                alert('Learning path duplicated! You can now edit the copy.');
            }
        }
    </script>
</body>
</html>