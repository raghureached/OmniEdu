<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LMS Leaderboard System - Complete Analytics</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        
        h2 {
            color: #34495e;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            margin-top: 40px;
        }
        
        h3 {
            color: #2980b9;
            margin-top: 30px;
        }
        
        .copy-btn {
            background-color: #27ae60;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px 5px;
            font-size: 12px;
        }
        
        .copy-btn:hover {
            background-color: #219a52;
        }
        
        .criteria-box {
            background-color: #e8f4fd;
            border: 2px solid #3498db;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            font-size: 13px;
        }
        
        .learning-paths-box {
            background-color: #fff3cd;
            border: 2px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-size: 12px;
        }
        
        .table-container {
            margin: 20px 0;
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 11px;
            font-family: 'Courier New', monospace;
        }
        
        th,
        td {
            border: 1px solid #000;
            padding: 4px;
            text-align: left;
            white-space: nowrap;
        }
        
        th {
            background-color: #3498db;
            color: white;
            font-weight: bold;
        }
        
        .rank-1 {
            background-color: #ffd700;
        }
        
        .rank-2 {
            background-color: #c0c0c0;
        }
        
        .rank-3 {
            background-color: #cd7f32;
        }
        
        .high-performer {
            background-color: #d5f4e6;
        }
        
        .stats-summary {
            background-color: #e8f5e8;
            border: 1px solid #4caf50;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            font-size: 12px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>LMS Leaderboard System - Complete Analytics & Rankings</h1>

        <div class="criteria-box">
            <h3>üèÜ GAMIFICATION SYSTEM CRITERIA</h3>

            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;">
                <div>
                    <h4>‚≠ê STARS SYSTEM</h4>
                    <ul>
                        <li><strong>1 Star per Course:</strong> Upon successful completion only</li>
                        <li><strong>Regular Courses:</strong> Status = "Completed"</li>
                        <li><strong>Assessment Courses:</strong> Status = "Passed" (not "Failed")</li>
                        <li><strong>In Progress/Failed:</strong> 0 Stars</li>
                    </ul>
                </div>

                <div>
                    <h4>üèÖ BADGES SYSTEM</h4>
                    <ul>
                        <li><strong>1 Badge per Learning Path:</strong> When all courses in path completed</li>
                        <li><strong>Sample Learning Paths:</strong></li>
                        <li style="margin-left: 20px;">‚Ä¢ Communication Skills (3 courses)</li>
                        <li style="margin-left: 20px;">‚Ä¢ Assessment Mastery (2 courses)</li>
                        <li><strong>Additional Achievement Badges:</strong> Based on performance</li>
                    </ul>
                </div>

                <div>
                    <h4>üí∞ CREDITS SYSTEM</h4>
                    <ul>
                        <li><strong>Regular Course:</strong> 2 credits upon completion</li>
                        <li><strong>Assessment Course:</strong> 5 credits upon passing</li>
                        <li><strong>Ongoing Courses (External):</strong> 0 credits (no minimum hours)</li>
                        <li><strong>Microsoft 365:</strong> 2 credits (3 hrs minimum requirement)</li>
                        <li><strong>In Progress/Failed:</strong> 0 Credits</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="learning-paths-box">
            <h4>üìö SAMPLE LEARNING PATHS (For Badge Calculation)</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div>
                    <strong>Communication Skills Path:</strong>
                    <ul style="margin: 5px 0;">
                        <li>Effective Email Communication</li>
                        <li>Listening Skills</li>
                        <li>Soft_Skills - An Introduction</li>
                        <li>English Practice Exam_2011</li>
                    </ul>
                </div>
                <div>
                    <strong>Assessment Mastery Path:</strong>
                    <ul style="margin: 5px 0;">
                        <li>English Practice Exam_2011</li>
                        <li>Excel_Competencey_Exam_Practice_Test</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="stats-summary" id="overall-stats"></div>

        <h2>üìä VIEW 1: Individual Employee Leaderboard</h2>
        <p><strong>Criteria:</strong> All employees across organizations ranked by total points (Stars + Credits). Anonymous cross-org ranking included.</p>
        <button class="copy-btn" onclick="copyTable('individual-leaderboard')">Copy Individual Leaderboard</button>
        <div class="table-container">
            <table id="individual-leaderboard">
                <thead>
                    <tr>
                        <th>Org_Rank</th>
                        <th>Global_Rank</th>
                        <th>Emp_ID</th>
                        <th>Name</th>
                        <th>Organization</th>
                        <th>Team</th>
                        <th>Role</th>
                        <th>Total_Stars</th>
                        <th>Total_Badges</th>
                        <th>Total_Credits</th>
                        <th>Total_Points</th>
                        <th>Courses_Completed</th>
                        <th>Assessments_Passed</th>
                        <th>Anonymous_Position</th>
                    </tr>
                </thead>
                <tbody id="individual-data">
                </tbody>
            </table>
        </div>

        <h2>üë• VIEW 2: Team Rankings</h2>
        <p><strong>Criteria:</strong> Teams ranked by average points per member and total team contribution.</p>
        <button class="copy-btn" onclick="copyTable('team-rankings')">Copy Team Rankings</button>
        <div class="table-container">
            <table id="team-rankings">
                <thead>
                    <tr>
                        <th>Team_Rank</th>
                        <th>Organization</th>
                        <th>Team_Name</th>
                        <th>Team_Size</th>
                        <th>Total_Stars</th>
                        <th>Total_Badges</th>
                        <th>Total_Credits</th>
                        <th>Total_Points</th>
                        <th>Avg_Points_Per_Member</th>
                        <th>Top_Performer</th>
                        <th>Completion_Rate</th>
                    </tr>
                </thead>
                <tbody id="team-data">
                </tbody>
            </table>
        </div>

        <h2>üè¢ VIEW 3: Organization Rankings</h2>
        <p><strong>Criteria:</strong> Organizations ranked by total learning metrics and engagement.</p>
        <button class="copy-btn" onclick="copyTable('org-rankings')">Copy Organization Rankings</button>
        <div class="table-container">
            <table id="org-rankings">
                <thead>
                    <tr>
                        <th>Org_Rank</th>
                        <th>Organization</th>
                        <th>Total_Employees</th>
                        <th>Total_Stars</th>
                        <th>Total_Badges</th>
                        <th>Total_Credits</th>
                        <th>Total_Points</th>
                        <th>Avg_Points_Per_Employee</th>
                        <th>Course_Completion_Rate</th>
                        <th>Assessment_Pass_Rate</th>
                        <th>Top_Team</th>
                    </tr>
                </thead>
                <tbody id="org-data">
                </tbody>
            </table>
        </div>

        <h2>üìà VIEW 4: Detailed Course Analytics</h2>
        <p><strong>Criteria:</strong> Course-wise performance metrics and credit allocation details.</p>
        <button class="copy-btn" onclick="copyTable('course-analytics')">Copy Course Analytics</button>
        <div class="table-container">
            <table id="course-analytics">
                <thead>
                    <tr>
                        <th>Course_Name</th>
                        <th>Course_Type</th>
                        <th>Duration</th>
                        <th>Credits_Per_Completion</th>
                        <th>Total_Enrolled</th>
                        <th>Total_Completed</th>
                        <th>Completion_Rate</th>
                        <th>Stars_Awarded</th>
                        <th>Credits_Distributed</th>
                        <th>Avg_Score</th>
                    </tr>
                </thead>
                <tbody id="course-data">
                </tbody>
            </table>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/chart.js/3.9.1/chart.min.js"></script>
    <script>
        // Course data with duration and credits
        const courseDetails = {
            "Boost Your Focus": {
                duration: "20 min",
                type: "Video",
                credits: 2
            },
            "Awareness Test": {
                duration: "10 min",
                type: "Video",
                credits: 2
            },
            "Microsoft 365 Help & Learning": {
                duration: "3+ hrs",
                type: "External Link",
                credits: 2
            },
            "Learn to Code": {
                duration: "Ongoing",
                type: "External Link",
                credits: 0
            },
            "AI at Meta": {
                duration: "Ongoing",
                type: "External Link",
                credits: 0
            },
            "AWS Blogs": {
                duration: "Ongoing",
                type: "External Link",
                credits: 0
            },
            "Microsoft AI Blogs": {
                duration: "Ongoing",
                type: "External Link",
                credits: 0
            },
            "Google Cloud Blog": {
                duration: "Ongoing",
                type: "External Link",
                credits: 0
            },
            "Employee Wellbeing - Sample": {
                duration: "20 min",
                type: "Text",
                credits: 2
            },
            "Effective Email Communication": {
                duration: "60 min",
                type: "PDF",
                credits: 5
            },
            "Listening Skills": {
                duration: "40 min",
                type: "PDF",
                credits: 2
            },
            "Remote Working Etiquette": {
                duration: "20 min",
                type: "PDF",
                credits: 2
            },
            "Emotional_Intelligence": {
                duration: "2 hrs",
                type: "PPT",
                credits: 5
            },
            "Soft_Skills - An Introduction": {
                duration: "2 hrs",
                type: "PPT",
                credits: 2
            },
            "Time Management - A Comprehensive Guide": {
                duration: "2 hrs",
                type: "PPT",
                credits: 5
            },
            "English Practice Exam_2011": {
                duration: "60 min",
                type: "Assessment",
                credits: 5
            },
            "Excel_Competencey_Exam_Practice_Test": {
                duration: "90 min",
                type: "Assessment",
                credits: 5
            },
            "Ocean Waves": {
                duration: "15 min",
                type: "Video",
                credits: 2
            },
            "Singing Narcissus Flycatcher": {
                duration: "5 min",
                type: "Video",
                credits: 2
            }
        };

        // Learning paths for badge calculation
        const learningPaths = {
            "Communication Skills": [
                "Effective Email Communication",
                "Listening Skills",
                "Soft_Skills - An Introduction",
                "English Practice Exam_2011"
            ],
            "Assessment Mastery": [
                "English Practice Exam_2011",
                "Excel_Competencey_Exam_Practice_Test"
            ]
        };

        // Assessment courses
        const assessmentCourses = [
            "English Practice Exam_2011",
            "Excel_Competencey_Exam_Practice_Test",
            "Time Management - A Comprehensive Guide",
            "Emotional_Intelligence",
            "Effective Email Communication"
        ];

        // Course data
        const courses = Object.keys(courseDetails);

        // Status options
        const regularStatuses = ["Assigned", "Enrolled", "In Progress", "Completed"];
        const assessmentStatuses = ["Assigned", "Enrolled", "In Progress", "Passed", "Failed"];

        // Organization data structures
        const organizations = {
            org1: {
                name: "BPO Services",
                prefix: "BPO",
                domain: "bposervices.com",
                teams: {
                    "Customer Support": {
                        subteams: ["Voice Support", "Chat Support", "Email Support"],
                        roles: ["Support Executive", "Senior Support Executive", "Team Lead", "Manager"]
                    },
                    "Technical Support": {
                        subteams: ["L1 Support", "L2 Support"],
                        roles: ["Technical Executive", "Senior Technical Executive", "Technical Lead", "Manager"]
                    },
                    "Quality Assurance": {
                        subteams: ["Call Monitoring", "Process Improvement"],
                        roles: ["QA Analyst", "Senior QA Analyst", "QA Lead", "Manager"]
                    },
                    "Training & Development": {
                        subteams: [],
                        roles: ["Trainer", "Senior Trainer", "Training Manager", "Manager"]
                    }
                },
                locations: ["Mumbai", "Bangalore", "Chennai", "Hyderabad"]
            },
            org2: {
                name: "IT/ITES",
                prefix: "IT",
                domain: "techsolutions.com",
                teams: {
                    "Development": {
                        subteams: ["Frontend", "Backend", "Full Stack"],
                        roles: ["Software Developer", "Senior Developer", "Tech Lead", "Manager"]
                    },
                    "Infrastructure": {
                        subteams: ["Cloud Ops", "DevOps"],
                        roles: ["System Admin", "Cloud Engineer", "DevOps Engineer", "Manager"]
                    },
                    "Business Analysis": {
                        subteams: ["Requirements", "Testing"],
                        roles: ["Business Analyst", "Senior BA", "BA Lead", "Manager"]
                    },
                    "Project Management": {
                        subteams: [],
                        roles: ["Project Coordinator", "Project Manager", "Senior PM", "Director"]
                    }
                },
                locations: ["Pune", "Noida", "Gurgaon", "Kolkata"]
            },
            org3: {
                name: "Sales",
                prefix: "SAL",
                domain: "salesforce.com",
                teams: {
                    "Inside Sales": {
                        subteams: ["Lead Generation", "Qualification", "Closing"],
                        roles: ["Sales Executive", "Senior Sales Executive", "Sales Lead", "Manager"]
                    },
                    "Field Sales": {
                        subteams: ["Enterprise", "SMB"],
                        roles: ["Field Sales Rep", "Senior Sales Rep", "Territory Manager", "Regional Manager"]
                    },
                    "Sales Operations": {
                        subteams: ["Analytics", "Process"],
                        roles: ["Sales Analyst", "Operations Specialist", "Operations Lead", "Manager"]
                    },
                    "Customer Success": {
                        subteams: [],
                        roles: ["CSM", "Senior CSM", "CS Lead", "Manager"]
                    }
                },
                locations: ["Delhi", "Mumbai", "Bangalore", "Ahmedabad"]
            }
        };

        // Sample names
        const firstNames = [
            "Rahul", "Priya", "Amit", "Sneha", "Rajesh", "Kavya", "Suresh", "Meera", "Vikram", "Anita",
            "Arjun", "Divya", "Kiran", "Pooja", "Manoj", "Ritu", "Anil", "Sonia", "Deepak", "Nisha",
            "Ravi", "Preeti", "Sanjay", "Veena", "Ashok", "Sunita", "Naveen", "Rekha", "Vinod", "Madhuri",
            "Rohit", "Swati", "Ajay", "Namita", "Prakash", "Seema", "Ramesh", "Geeta", "Nitin", "Shilpa",
            "Sachin", "Rashmi", "Mahesh", "Usha", "Santosh", "Vandana", "Yogesh", "Pallavi", "Harish", "Manju"
        ];

        const lastNames = [
            "Sharma", "Patel", "Singh", "Kumar", "Gupta", "Agarwal", "Jain", "Verma", "Shah", "Mehta",
            "Reddy", "Nair", "Iyer", "Rao", "Pillai", "Menon", "Joshi", "Desai", "Thakur", "Pandey",
            "Mishra", "Tiwari", "Srivastava", "Chopra", "Malhotra", "Kapoor", "Arora", "Bansal", "Goyal", "Mittal"
        ];

        // Utility functions
        function getRandomElement(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        function getRandomDate(start, end) {
            return new Date(start.getTime() + Math.random() * (end.getTime() - start.getTime()));
        }

        function formatDate(date) {
            return date.toISOString().split('T')[0];
        }

        function generateEmployee(empId, orgData, orgKey) {
            const firstName = getRandomElement(firstNames);
            const lastName = getRandomElement(lastNames);
            const name = `${firstName} ${lastName}`;
            const email = `${firstName.toLowerCase()}.${lastName.toLowerCase()}@${orgData.domain}`;

            const teamNames = Object.keys(orgData.teams);
            const teamName = getRandomElement(teamNames);
            const team = orgData.teams[teamName];

            let subteam = "";
            if (team.subteams.length > 0) {
                subteam = getRandomElement(team.subteams);
            }

            const role = getRandomElement(team.roles);
            const location = getRandomElement(orgData.locations);
            const hireDate = formatDate(getRandomDate(new Date(2020, 0, 1), new Date(2024, 11, 31)));

            let manager = "";
            if (role !== "Manager" && role !== "Director") {
                const managerNames = ["John Smith", "Sarah Johnson", "Michael Brown", "Lisa Davis"];
                manager = getRandomElement(managerNames);
            }

            return {
                empId,
                name,
                email,
                role,
                department: orgData.name,
                team: teamName,
                subteam: subteam || "NA",
                manager: manager || "NA",
                hireDate,
                location
            };
        }

        function assignCourses(employee, shouldHaveAssessment = false) {
            const numCourses = Math.floor(Math.random() * 3) + 2; // 2-4 courses per employee
            const assignedCourses = [];
            const shuffledCourses = [...courses].sort(() => 0.5 - Math.random());

            if (shouldHaveAssessment) {
                const assessmentCourse = getRandomElement(assessmentCourses);
                const status = getRandomElement(["Passed", "Failed"]);

                assignedCourses.push({
                    courseName: assessmentCourse,
                    status: status
                });

                const index = shuffledCourses.indexOf(assessmentCourse);
                if (index > -1) {
                    shuffledCourses.splice(index, 1);
                }
            }

            const remainingCourses = numCourses - assignedCourses.length;
            for (let i = 0; i < remainingCourses && i < shuffledCourses.length; i++) {
                const course = shuffledCourses[i];
                const isAssessment = assessmentCourses.includes(course);
                let status;

                if (isAssessment) {
                    status = getRandomElement(assessmentStatuses);
                    if ((status === "Failed" || status === "Passed") && Math.random() < 0.6) {
                        status = getRandomElement(["Assigned", "Enrolled", "In Progress"]);
                    }
                } else {
                    status = getRandomElement(regularStatuses);
                }

                assignedCourses.push({
                    courseName: course,
                    status: status
                });
            }

            return assignedCourses;
        }

        function calculateLeaderboardMetrics(employee, courses) {
            let stars = 0;
            let credits = 0;
            let coursesCompleted = 0;
            let assessmentsPassed = 0;

            courses.forEach(course => {
                const courseDetail = courseDetails[course.courseName];
                const isAssessment = assessmentCourses.includes(course.courseName);

                // Stars calculation
                if ((isAssessment && course.status === "Passed") ||
                    (!isAssessment && course.status === "Completed")) {
                    stars += 1;
                    coursesCompleted += 1;

                    // Credits calculation
                    credits += courseDetail.credits;

                    if (isAssessment && course.status === "Passed") {
                        assessmentsPassed += 1;
                    }
                }
            });

            // Badges calculation
            let badges = 0;
            Object.keys(learningPaths).forEach(pathName => {
                const pathCourses = learningPaths[pathName];
                const completedPathCourses = courses.filter(course =>
                    pathCourses.includes(course.courseName) &&
                    ((assessmentCourses.includes(course.courseName) && course.status === "Passed") ||
                        (!assessmentCourses.includes(course.courseName) && course.status === "Completed"))
                );

                if (completedPathCourses.length === pathCourses.length) {
                    badges += 1;
                }
            });

            const totalPoints = stars + credits;

            return {
                stars,
                badges,
                credits,
                totalPoints,
                coursesCompleted,
                assessmentsPassed
            };
        }

        function generateAllData() {
            const allEmployees = [];

            Object.keys(organizations).forEach(orgKey => {
                const orgData = organizations[orgKey];

                // Randomly select 6-8 employees to have assessment courses with Passed/Failed
                const numAssessmentEmployees = Math.floor(Math.random() * 3) + 6; // 6-8
                const assessmentEmployeeIndices = [];
                while (assessmentEmployeeIndices.length < numAssessmentEmployees) {
                    const randomIndex = Math.floor(Math.random() * 30) + 1;
                    if (!assessmentEmployeeIndices.includes(randomIndex)) {
                        assessmentEmployeeIndices.push(randomIndex);
                    }
                }

                // Generate 30 employees per organization
                for (let i = 1; i <= 30; i++) {
                    const empId = `${orgData.prefix}${String(i).padStart(3, '0')}`;
                    const employee = generateEmployee(empId, orgData, orgKey);
                    const shouldHaveAssessment = assessmentEmployeeIndices.includes(i);
                    const courses = assignCourses(employee, shouldHaveAssessment);
                    const metrics = calculateLeaderboardMetrics(employee, courses);

                    allEmployees.push({
                        ...employee,
                        courses: courses,
                        ...metrics
                    });
                }
            });

            return allEmployees;
        }

        function populateIndividualLeaderboard(employees) {
            // Sort by total points descending
            const sortedEmployees = [...employees].sort((a, b) => b.totalPoints - a.totalPoints);

            const tbody = document.getElementById('individual-data');
            tbody.innerHTML = '';

            // Calculate organization-wise rankings
            const orgRankings = {};
            Object.keys(organizations).forEach(orgKey => {
                const orgName = organizations[orgKey].name;
                const orgEmployees = sortedEmployees.filter(emp => emp.department === orgName);
                orgEmployees.forEach((emp, index) => {
                    orgRankings[emp.empId] = index + 1;
                });
            });

            sortedEmployees.forEach((emp, globalIndex) => {
                const row = document.createElement('tr');
                const rowClass = globalIndex < 3 ? `rank-${globalIndex + 1}` :
                    emp.totalPoints > 15 ? 'high-performer' : '';
                row.className = rowClass;

                const anonymousPosition = `#${globalIndex + 1} of ${sortedEmployees.length}`;

                row.innerHTML = `
                    <td>${orgRankings[emp.empId]}</td>
                    <td>${globalIndex + 1}</td>
                    <td>${emp.empId}</td>
                    <td>${emp.name}</td>
                    <td>${emp.department}</td>
                    <td>${emp.team}</td>
                    <td>${emp.role}</td>
                    <td>${emp.stars}</td>
                    <td>${emp.badges}</td>
                    <td>${emp.credits}</td>
                    <td>${emp.totalPoints}</td>
                    <td>${emp.coursesCompleted}</td>
                    <td>${emp.assessmentsPassed}</td>
                    <td>${anonymousPosition}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function populateTeamRankings(employees) {
            const teamStats = {};

            employees.forEach(emp => {
                const teamKey = `${emp.department}-${emp.team}`;
                if (!teamStats[teamKey]) {
                    teamStats[teamKey] = {
                        organization: emp.department,
                        teamName: emp.team,
                        members: [],
                        totalStars: 0,
                        totalBadges: 0,
                        totalCredits: 0,
                        totalPoints: 0,
                        topPerformer: {
                            name: '',
                            points: 0
                        }
                    };
                }

                teamStats[teamKey].members.push(emp);
                teamStats[teamKey].totalStars += emp.stars;
                teamStats[teamKey].totalBadges += emp.badges;
                teamStats[teamKey].totalCredits += emp.credits;
                teamStats[teamKey].totalPoints += emp.totalPoints;

                if (emp.totalPoints > teamStats[teamKey].topPerformer.points) {
                    teamStats[teamKey].topPerformer = {
                        name: emp.name,
                        points: emp.totalPoints
                    };
                }
            });

            // Calculate averages and completion rates
            const teamRankings = Object.values(teamStats).map(team => {
                const avgPoints = Math.round(team.totalPoints / team.members.length * 100) / 100;
                const completionRate = Math.round(
                    team.members.reduce((sum, member) => sum + member.coursesCompleted, 0) /
                    team.members.length * 100
                ) / 100;

                return {
                    ...team,
                    teamSize: team.members.length,
                    avgPointsPerMember: avgPoints,
                    completionRate: completionRate + '%'
                };
            }).sort((a, b) => b.avgPointsPerMember - a.avgPointsPerMember);

            const tbody = document.getElementById('team-data');
            tbody.innerHTML = '';

            teamRankings.forEach((team, index) => {
                const row = document.createElement('tr');
                const rowClass = index < 3 ? `rank-${index + 1}` : '';
                row.className = rowClass;

                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${team.organization}</td>
                    <td>${team.teamName}</td>
                    <td>${team.teamSize}</td>
                    <td>${team.totalStars}</td>
                    <td>${team.totalBadges}</td>
                    <td>${team.totalCredits}</td>
                    <td>${team.totalPoints}</td>
                    <td>${team.avgPointsPerMember}</td>
                    <td>${team.topPerformer.name}</td>
                    <td>${team.completionRate}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function populateOrgRankings(employees) {
            const orgStats = {};

            employees.forEach(emp => {
                if (!orgStats[emp.department]) {
                    orgStats[emp.department] = {
                        organization: emp.department,
                        employees: [],
                        totalStars: 0,
                        totalBadges: 0,
                        totalCredits: 0,
                        totalPoints: 0,
                        topTeam: {
                            name: '',
                            points: 0
                        }
                    };
                }

                orgStats[emp.department].employees.push(emp);
                orgStats[emp.department].totalStars += emp.stars;
                orgStats[emp.department].totalBadges += emp.badges;
                orgStats[emp.department].totalCredits += emp.credits;
                orgStats[emp.department].totalPoints += emp.totalPoints;
            });

            // Calculate averages and rates
            const orgRankings = Object.values(orgStats).map(org => {
                const avgPoints = Math.round(org.totalPoints / org.employees.length * 100) / 100;
                const completionRate = Math.round(
                    org.employees.reduce((sum, emp) => sum + emp.coursesCompleted, 0) /
                    org.employees.length * 100
                ) / 100;
                const passRate = Math.round(
                    org.employees.reduce((sum, emp) => sum + emp.assessmentsPassed, 0) /
                    Math.max(org.employees.reduce((sum, emp) => sum + emp.assessmentsPassed, 0), 1) * 100
                ) / 100;

                return {
                    ...org,
                    totalEmployees: org.employees.length,
                    avgPointsPerEmployee: avgPoints,
                    completionRate: completionRate + '%',
                    passRate: passRate + '%',
                    topTeam: 'Various Teams'
                };
            }).sort((a, b) => b.avgPointsPerEmployee - a.avgPointsPerEmployee);

            const tbody = document.getElementById('org-data');
            tbody.innerHTML = '';

            orgRankings.forEach((org, index) => {
                const row = document.createElement('tr');
                const rowClass = index < 3 ? `rank-${index + 1}` : '';
                row.className = rowClass;

                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${org.organization}</td>
                    <td>${org.totalEmployees}</td>
                    <td>${org.totalStars}</td>
                    <td>${org.totalBadges}</td>
                    <td>${org.totalCredits}</td>
                    <td>${org.totalPoints}</td>
                    <td>${org.avgPointsPerEmployee}</td>
                    <td>${org.completionRate}</td>
                    <td>${org.passRate}</td>
                    <td>${org.topTeam}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function populateCourseAnalytics(employees) {
            const courseStats = {};

            // Initialize course stats
            Object.keys(courseDetails).forEach(courseName => {
                courseStats[courseName] = {
                    courseName,
                    type: courseDetails[courseName].type,
                    duration: courseDetails[courseName].duration,
                    creditsPerCompletion: courseDetails[courseName].credits,
                    totalEnrolled: 0,
                    totalCompleted: 0,
                    starsAwarded: 0,
                    creditsDistributed: 0,
                    scores: []
                };
            });

            // Collect stats from all employees
            employees.forEach(emp => {
                emp.courses.forEach(course => {
                    const stats = courseStats[course.courseName];
                    if (stats) {
                        stats.totalEnrolled++;

                        const isAssessment = assessmentCourses.includes(course.courseName);
                        if ((isAssessment && course.status === "Passed") ||
                            (!isAssessment && course.status === "Completed")) {
                            stats.totalCompleted++;
                            stats.starsAwarded++;
                            stats.creditsDistributed += courseDetails[course.courseName].credits;
                        }

                        if (isAssessment && (course.status === "Passed" || course.status === "Failed")) {
                            const score = course.status === "Passed" ?
                                Math.floor(Math.random() * 20) + 70 :
                                Math.floor(Math.random() * 19) + 51;
                            stats.scores.push(score);
                        }
                    }
                });
            });

            const tbody = document.getElementById('course-data');
            tbody.innerHTML = '';

            Object.values(courseStats).forEach(course => {
                const completionRate = course.totalEnrolled > 0 ?
                    Math.round(course.totalCompleted / course.totalEnrolled * 100) : 0;
                const avgScore = course.scores.length > 0 ?
                    Math.round(course.scores.reduce((sum, score) => sum + score, 0) / course.scores.length) : 'N/A';

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${course.courseName}</td>
                    <td>${course.type}</td>
                    <td>${course.duration}</td>
                    <td>${course.creditsPerCompletion}</td>
                    <td>${course.totalEnrolled}</td>
                    <td>${course.totalCompleted}</td>
                    <td>${completionRate}%</td>
                    <td>${course.starsAwarded}</td>
                    <td>${course.creditsDistributed}</td>
                    <td>${avgScore}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateOverallStats(employees) {
            const totalEmployees = employees.length;
            const totalStars = employees.reduce((sum, emp) => sum + emp.stars, 0);
            const totalBadges = employees.reduce((sum, emp) => sum + emp.badges, 0);
            const totalCredits = employees.reduce((sum, emp) => sum + emp.credits, 0);
            const totalCompleted = employees.reduce((sum, emp) => sum + emp.coursesCompleted, 0);
            const totalPassed = employees.reduce((sum, emp) => sum + emp.assessmentsPassed, 0);

            const statsElement = document.getElementById('overall-stats');
            statsElement.innerHTML = `
                <h4>üìä OVERALL SYSTEM STATISTICS</h4>
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px;">
                    <div><strong>Total Employees:</strong> ${totalEmployees}</div>
                    <div><strong>Total Stars Earned:</strong> ${totalStars}</div>
                    <div><strong>Total Badges Earned:</strong> ${totalBadges}</div>
                    <div><strong>Total Credits Earned:</strong> ${totalCredits}</div>
                    <div><strong>Courses Completed:</strong> ${totalCompleted}</div>
                    <div><strong>Assessments Passed:</strong> ${totalPassed}</div>
                    <div><strong>Avg Points per Employee:</strong> ${Math.round((totalStars + totalCredits) / totalEmployees * 100) / 100}</div>
                    <div><strong>Active Learning Paths:</strong> ${Object.keys(learningPaths).length}</div>
                </div>
            `;
        }

        function copyTable(tableId) {
            const table = document.getElementById(tableId);
            let tableText = '';

            const rows = table.querySelectorAll('tr');
            rows.forEach(row => {
                const cells = row.querySelectorAll('th, td');
                const rowData = Array.from(cells).map(cell => cell.textContent.trim()).join('\t');
                tableText += rowData + '\n';
            });

            navigator.clipboard.writeText(tableText).then(() => {
                alert('Table copied to clipboard! You can now paste it into Excel or Word.');
            }).catch(err => {
                const textArea = document.createElement('textarea');
                textArea.value = tableText;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('Table copied to clipboard! You can now paste it into Excel or Word.');
            });
        }

        // Initialize all data when page loads
        document.addEventListener('DOMContentLoaded', function() {
            const allEmployees = generateAllData();

            updateOverallStats(allEmployees);
            populateIndividualLeaderboard(allEmployees);
            populateTeamRankings(allEmployees);
            populateOrgRankings(allEmployees);
            populateCourseAnalytics(allEmployees);
        });
    </script>
</body>

</html>